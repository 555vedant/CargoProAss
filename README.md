CargoAI Backend
This is the backend for the CargoAI application, a platform for managing cargo loads and bookings. Built with Spring Boot, it provides RESTful APIs to create, retrieve, update, and delete loads and bookings, integrated with a PostgreSQL database. The frontend is a simple HTML/JavaScript interface for interacting with these APIs. This project includes comprehensive unit tests for core services, achieving >60% coverage using JUnit 5 and Mockito.
Features

Load Management: Create, delete, and list cargo loads with details like shipper ID, facility, product type, and status.
Booking Management: Create, update, delete, and list bookings linked to loads via a @ManyToOne relationship.
REST APIs: Exposed via /api/loads and /api/bookings, with pagination support.
Frontend: Basic HTML/JavaScript UI to interact with the backend.
Testing: Unit tests for LoadService and BookingService with >60% coverage.
Error Handling: Custom ResourceNotFoundException for invalid load/booking IDs.
Database: PostgreSQL with JPA/Hibernate for data persistence.

Tech Stack

Backend: Spring Boot 3.x, Java 17, Maven
Database: PostgreSQL
Frontend: HTML, JavaScript (fetch API)
Testing: JUnit 5, Mockito, JaCoCo
Dependencies: Spring Data JPA, Spring Web, PostgreSQL Driver, OpenAPI (Swagger UI)

Prerequisites

Java 17 or higher
Maven 3.6+
PostgreSQL 13+ (with a database named cargoai)
Node.js (optional, for serving frontend statically)
Postman (optional, for API testing)

Setup

Clone the Repository:
git clone <repository-url>
cd cargoai-backend


Configure PostgreSQL:

Create a database named cargoai:psql -U postgres
CREATE DATABASE cargoai;


Update src/main/resources/application.yml with your PostgreSQL credentials:spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/cargoai
    username: postgres
    password: your-password
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        show_sql: true
        format_sql: true
logging:
  level:
    org.hibernate.SQL: DEBUG
    com.cargoai.assignment: DEBUG




Build the Project:
mvn clean install


Run the Application:
mvn spring-boot:run


The backend runs on http://localhost:8080.


Serve the Frontend:

Copy index.html and script.js to a static server (e.g., using http-server):npm install -g http-server
http-server -p 8080


Access the UI at http://localhost:8080/index.html.



API Endpoints
Loads

POST /api/loads: Create a new load.{
  "shipperId": "SHIP123",
  "facility": {
    "loadingPoint": "Delhi Warehouse",
    "unloadingPoint": "Mumbai Depot",
    "loadingDate": "2025-07-31T10:00:00",
    "unloadingDate": "2025-08-01T18:00:00"
  },
  "productType": "Electronics",
  "truckType": "Refrigerated",
  "noOfTrucks": 3,
  "weight": 4500.75,
  "comment": "Handle with care",
  "datePosted": "2025-07-30T15:30:00",
  "status": "POSTED"
}


GET /api/loads?page=0&size=10: List loads (paginated).
DELETE /api/loads/{id}: Delete a load by UUID.

Bookings

POST /api/bookings: Create a new booking (requires a valid loadId).{
  "loadId": "123e4567-e89b-12d3-a456-426614174000",
  "transporterId": "TRANS123",
  "proposedRate": 1000.50,
  "comment": "Urgent delivery",
  "status": "PENDING",
  "requestedAt": "2025-07-30T15:30:00"
}


GET /api/bookings?page=0&size=10: List bookings (paginated).
PUT /api/bookings/{id}: Update a booking by UUID.
DELETE /api/bookings/{id}: Delete a booking by UUID.
GET /api/bookings/{id}: Get a booking by UUID.

Testing
The project includes unit tests for LoadService and BookingService, covering >60% of the code using JUnit 5 and Mockito.

Run Tests:
mvn clean test


Check Coverage:
mvn jacoco:report


Open target/site/jacoco/index.html to view coverage (>60% for LoadService and BookingService).


Test Files:

src/test/java/com/cargoai/assignment/cargoai_backend/service/LoadServiceTest.java
src/test/java/com/cargoai/assignment/cargoai_backend/service/BookingServiceTest.java



Database
The database schema is auto-generated by Hibernate (ddl-auto: update). Key tables:

loads: Stores load details (id, shipper_id, facility, product_type, etc.).
bookings: Stores booking details (id, load_id, transporter_id, proposed_rate, etc.), with a foreign key to loads.

Verify data:
psql -U postgres -d cargoai
SELECT * FROM loads;
SELECT * FROM bookings;

Troubleshooting

API Errors:
If POST /api/bookings fails with ResourceNotFoundException, ensure the loadId exists in the loads table.
Check logs: tail -f target/spring-boot.log.


Test Failures:
Ensure BookingService and LoadService match the provided implementations.
Verify Booking and Load entities have the correct @ManyToOne and enum definitions.


Frontend Issues:
If the UI shows undefined errors, check script.js for proper response handling (data.content).
Inspect browser console (F12) for API response details.



Known Issues (Resolved)

Fixed ObjectOptimisticLockingFailureException by using saveAndFlush in LoadService.
Fixed Swagger UI issues with PagedModel for pagination.
Fixed undefined UUID errors in frontend by validating id in script.js.
Fixed BookingServiceTest failures (NullPointerException) by ensuring proper mock initialization.

Contributing

Fork the repository.
Create a feature branch: git checkout -b feature-name.
Commit changes: git commit -m "Add feature".
Push to the branch: git push origin feature-name.
Open a pull request.

License
This project is licensed under the MIT License.
